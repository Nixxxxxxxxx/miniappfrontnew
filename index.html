<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Проверка подписки</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <button id="check">Проверить подписку</button>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("check");

      btn.addEventListener("click", async () => {
        if (window.Telegram && window.Telegram.WebApp) {
          const tg = window.Telegram.WebApp;
          const user = tg.initDataUnsafe?.user;

          if (!user || !user.id) {
            alert("Не удалось получить данные пользователя");
            return;
          }

          try {
            const response = await fetch(
              "https://tg-bot-0bbn.onrender.com/check-subscription",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_id: user.id }),
              }
            );
            const data = await response.json();

            if (data.status === "subscribed") {
              alert("Вы подписаны!"); // Или редирект window.location.href = ...
            } else {
              alert("❌ Вы не подписаны на канал.");
            }
          } catch (err) {
            alert("Ошибка при проверке подписки");
          }
        } else {
          alert("Пожалуйста, откройте через Telegram");
        }
      });
    });
  </script>
</body>
</html>
